# Architecture Diagram

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Telegram Digest PoC                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User CLI  â”‚â”€â”€â”€â”€â–¶â”‚  main.py     â”‚â”€â”€â”€â”€â–¶â”‚ Configuration   â”‚
â”‚  Arguments  â”‚     â”‚  (Orchestr.) â”‚     â”‚   (config.py)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
        â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TelegramFetcher  â”‚                   â”‚ DigestGenerator  â”‚
â”‚                  â”‚                   â”‚                  â”‚
â”‚ - Connect to TG  â”‚                   â”‚ - Format msgs    â”‚
â”‚ - Fetch messages â”‚                   â”‚ - Estimate size  â”‚
â”‚ - Filter by date â”‚                   â”‚ - Choose method  â”‚
â”‚ - Extract URLs   â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
         â”‚                                      â–¼
         â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                            â”‚ CerebrasClient   â”‚
         â”‚                            â”‚                  â”‚
         â”‚                            â”‚ - Generate       â”‚
         â”‚                            â”‚ - Map-reduce     â”‚
         â”‚                            â”‚ - Format prompt  â”‚
         â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                     â”‚
         â–¼                                     â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           Generated Digest                   â”‚
    â”‚  (Structured text with categories & links)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ OutputHandler  â”‚
         â”‚                â”‚
         â”‚ - Print        â”‚
         â”‚ - Save to file â”‚
         â”‚ - Send to TG   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

```
1. INPUT
   â”‚
   â”œâ”€ Channels: [@channel1, @channel2, ...]
   â”œâ”€ Date Range: [start_date, end_date]
   â””â”€ Options: [output_file, telegram_target, ...]
   â”‚
   â–¼
2. TELEGRAM FETCHING
   â”‚
   â”œâ”€ Connect with Telethon (MTProto)
   â”œâ”€ Iterate through channels
   â”œâ”€ Filter messages by date
   â””â”€ Extract: text, links, metadata
   â”‚
   â–¼
3. MESSAGE FORMATTING
   â”‚
   â”œâ”€ Format each message:
   â”‚  â”‚
   â”‚  â””â”€ === Channel Name â€” Date ===
   â”‚     Message text
   â”‚     Link: https://t.me/channel/123
   â”‚     URLs: [url1, url2, ...]
   â”‚
   â””â”€ Combine all messages
   â”‚
   â–¼
4. SIZE ESTIMATION
   â”‚
   â”œâ”€ Estimate tokens (chars / 4)
   â”‚
   â””â”€ Decision:
      â”œâ”€ < 50k tokens  â†’ Single-pass
      â””â”€ > 50k tokens  â†’ Map-reduce
   â”‚
   â–¼
5A. SINGLE-PASS                    5B. MAP-REDUCE
    â”‚                                  â”‚
    â””â”€ Send all to LLM                 â”œâ”€ Split into chunks
       with digest prompt              â”œâ”€ Process each chunk
                                       â”œâ”€ Generate partial summaries
                                       â””â”€ Combine partials â†’ Final digest
    â”‚                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â–¼
6. LLM PROCESSING (Cerebras)
   â”‚
   â”œâ”€ System Prompt:
   â”‚  â””â”€ "Group by categories, create summaries, keep links..."
   â”‚
   â”œâ”€ User Prompt:
   â”‚  â””â”€ Messages text
   â”‚
   â””â”€ Response:
      â””â”€ Structured digest with:
         â”œâ”€ ğŸ”¬ Research: summary + links
         â”œâ”€ ğŸ› ï¸ Tools: summary + links
         â”œâ”€ ğŸ“° News: summary + links
         â”œâ”€ ğŸ“š Tutorials: summary + links
         â””â”€ ğŸ’¡ Other: summary + links
   â”‚
   â–¼
7. OUTPUT
   â”‚
   â”œâ”€ Console: Print formatted digest
   â”œâ”€ File: Save to digest_TIMESTAMP.txt
   â””â”€ Telegram: Send to channel/chat
```

## Component Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    config.py                          â”‚
â”‚  (Configuration, Environment Variables, Validation)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–²
                          â”‚ (used by all)
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   telegram   â”‚  â”‚   cerebras   â”‚  â”‚    output    â”‚
â”‚   _fetcher   â”‚  â”‚   _client    â”‚  â”‚   _handler   â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ - Session    â”‚  â”‚ - API Client â”‚  â”‚ - File I/O   â”‚
â”‚ - Messages   â”‚  â”‚ - Prompts    â”‚  â”‚ - TG Send    â”‚
â”‚ - Filtering  â”‚  â”‚ - Map-reduce â”‚  â”‚ - Splitting  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ digest_generator â”‚
                â”‚                  â”‚
                â”‚ - Orchestration  â”‚
                â”‚ - Size decision  â”‚
                â”‚ - Formatting     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–²
                          â”‚
                          â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ main.py â”‚
                    â”‚  (CLI)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Map-Reduce Flow (for large datasets)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Large Message Collection          â”‚
â”‚  (> 50,000 tokens)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Split into    â”‚
     â”‚  Chunks        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼         â–¼         â–¼
  Chunk1   Chunk2   Chunk3   Chunk4
    â”‚         â”‚         â”‚         â”‚
    â–¼         â–¼         â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      MAP Phase                      â”‚
â”‚  (Process each chunk separately)    â”‚
â”‚                                     â”‚
â”‚  Cerebras API â†’ Partial Summary 1   â”‚
â”‚  Cerebras API â†’ Partial Summary 2   â”‚
â”‚  Cerebras API â†’ Partial Summary 3   â”‚
â”‚  Cerebras API â†’ Partial Summary 4   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Combine all   â”‚
     â”‚  partial       â”‚
     â”‚  summaries     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      REDUCE Phase                   â”‚
â”‚  (Merge into final digest)          â”‚
â”‚                                     â”‚
â”‚  Cerebras API â†’                     â”‚
â”‚  - Merge categories                 â”‚
â”‚  - Remove duplicates                â”‚
â”‚  - Consolidate links                â”‚
â”‚  - Create final structure           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   Final    â”‚
       â”‚   Digest   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security & Configuration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  .env file  â”‚
â”‚             â”‚
â”‚ API_ID      â”‚
â”‚ API_HASH    â”‚
â”‚ CEREBRAS_   â”‚
â”‚   API_KEY   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  python-dotenv   â”‚
â”‚  (load vars)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Config class   â”‚
â”‚                  â”‚
â”‚  - Load          â”‚
â”‚  - Validate      â”‚
â”‚  - Provide       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application     â”‚
â”‚  Components      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Handling Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Input     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Validate   â”‚â”€â”€â”€ Invalid â”€â”€â†’ Error Message
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
         â”‚ Valid                        â”‚
         â–¼                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
    â”‚ TG Fetch   â”‚â”€â”€â”€ Error â”€â”€â†’ Log + Retry/Skip
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
         â”‚ Success                      â”‚
         â–¼                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
    â”‚ LLM Call   â”‚â”€â”€â”€ Error â”€â”€â†’ Fallback/Partial
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
         â”‚ Success                      â”‚
         â–¼                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
    â”‚ Output     â”‚â”€â”€â”€ Error â”€â”€â†’ Save locally
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
         â”‚                              â”‚
         â–¼                              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
    â”‚  Success   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
